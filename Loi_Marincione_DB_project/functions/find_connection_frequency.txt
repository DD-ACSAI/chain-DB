DECLARE    
    curr_date   DATE;
    run_avg     REAL;
BEGIN
    run_avg := 0;
    curr_date := CURRENT_DATE - INTERVAL '32 day';
    WHILE curr_date < CURRENT_DATE LOOP
        run_avg := run_avg + (
          SELECT COUNT(*)
          FROM "Crossing" JOIN "Shipment" ON ("Crossing"."ShipmentCode" = "Shipment"."ID")
          WHERE "Crossing"."AllowedVehicle" = "allow_type" AND
                "Crossing"."PlaceA" = "placeA" AND
                "Crossing"."PlaceB" = "placeB" AND
                "Shipment"."EndDateTime" < curr_date + INTERVAL '1 day' AND
                "Shipment"."EndDateTime" >= curr_date
          ) / 31;
         curr_date := curr_date + INTERVAL '1 day';
    END LOOP;
    
    RETURN run_avg;
END